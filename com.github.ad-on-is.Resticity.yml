id: com.github.ad-on-is.Resticity
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: resticity
finish-args:
  - --share=ipc # Share IPC namespace with the host (necessary for X11).
  - --socket=x11
  - --device=dri # OpenGL rendering support.
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=home
build-options:
  env:
    - GOBIN=/app/bin
    - GOROOT=/usr/lib/sdk/golang
modules:
    - name: resticity
      buildsystem: simple
      build-commands:
        - $GOROOT/bin/go install github.com/wailsapp/wails/v2/cmd/wails@latest
        - $GOBIN/wails build
        - install -Dm00755 build/bin/resticity $FLATPAK_DEST/bin/resticity
        - install -Dm00644 build/bin/public $FLATPAK_DEST/bin/public
        - install -Dm00644 frontend/public/appicon.png.png $FLATPAK_DEST/share/icons/hicolor/256x256/apps/$FLATPAK_ID.png
        - install -Dm00644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
        - install -Dm00644 $FLATPAK_ID.appdata.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
      sources:
        - type: archive
          url: "https://github.com/ad-on-is/resticity/archive/refs/tags/v1.0.0.tar.gz"
          sha256: a9d3b920404b3b699da757a9641ebc75cf43e35515dd9879622de33c6d104b63